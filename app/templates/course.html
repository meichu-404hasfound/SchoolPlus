{% extends "base.html" %}

{% block title %}Course · School Platform{% endblock %}

{% block content %}
<section class="py-4">
  <div class="container">
    <!-- Header -->
    <div class="d-flex flex-wrap justify-content-between align-items-center mb-4">
      <h2 class="fw-bold mb-2">
        <i class="bi bi-journal-bookmark-fill text-primary me-2"></i> {{ course.name }}
      </h2>
      <span class="badge bg-info text-dark px-3 py-2 rounded-pill">
        {{ course.code }}
      </span>
    </div>

    <div class="row g-4">
      <!-- Left Column -->
      <div class="col-lg-8">
        <!-- Description -->
        <div class="card rounded-3 shadow-soft hover-raise mb-3">
          <div class="card-body">
            <h5 class="fw-bold mb-3"><i class="bi bi-info-circle-fill text-secondary me-2"></i> Description</h5>
            <p class="text-muted small mb-0">{{ course.description }}</p>
          </div>
        </div>

        <!-- Staff -->
        <div class="card rounded-3 shadow-soft hover-raise mb-3">
          <div class="card-body">
            <h5 class="fw-bold mb-3"><i class="bi bi-people-fill text-primary me-2"></i> Teaching Staff</h5>
            <ul class="list-group list-group-flush">
              <li class="list-group-item">
                <i class="bi bi-person-badge-fill text-success me-2"></i>
                <strong>Professor:</strong> {{ course.professor }}
              </li>
              <li class="list-group-item">
                <i class="bi bi-people text-info me-2"></i>
                <strong>Teaching Assistants:</strong>
                <ul class="small mt-1 mb-0">
                  {% for ta in course.tas %}
                  <li>{{ ta }}</li>
                  {% endfor %}
                </ul>
              </li>
            </ul>
          </div>
        </div>

        <!-- Materials -->
        <div class="card rounded-3 shadow-soft hover-raise mb-3">
          <div class="card-body">
            <h5 class="fw-bold mb-3"><i class="bi bi-folder-fill text-warning me-2"></i> Materials</h5>
            <ul class="list-unstyled small mb-0">
              {% for material in course.materials %}
              <li class="mb-2">
                <i class="bi bi-file-earmark-text me-1 text-primary"></i>
                <a href="{{ material.url }}" class="text-decoration-none">{{ material.name }}</a>
              </li>
              {% else %}
              <li class="text-muted"><em>No materials available.</em></li>
              {% endfor %}
            </ul>
          </div>
        </div>

        <!-- Reviews -->
        <div class="card rounded-3 shadow-soft hover-raise">
          <div class="card-body">
            <h5 class="fw-bold mb-3"><i class="bi bi-chat-left-text-fill text-info me-2"></i> Reviews</h5>
            <ul class="list-unstyled small mb-3">
              {% for review in course.reviews %}
              <li class="mb-3 border-bottom pb-2">
                <div class="d-flex justify-content-between">
                  <strong>{{ review.user }}</strong>
                  <span class="text-warning">
                    {% for i in range(review.rating) %}
                    <i class="bi bi-star-fill"></i>
                    {% endfor %}
                    {% for i in range(5 - review.rating) %}
                    <i class="bi bi-star"></i>
                    {% endfor %}
                  </span>
                </div>
                <p class="mb-0">{{ review.comment }}</p>
              </li>
              {% else %}
              <li class="text-muted"><em>No reviews yet.</em></li>
              {% endfor %}
            </ul>
            <form method="post" class="mt-3">
              <div class="mb-2">
                <label class="form-label small">Leave a review</label>
                <textarea class="form-control rounded-3" name="comment" rows="3"></textarea>
              </div>
              <div class="mb-2">
                <label class="form-label small">Rating</label>
                <select class="form-select rounded-pill" name="rating">
                  <option value="5">⭐⭐⭐⭐⭐</option>
                  <option value="4">⭐⭐⭐⭐</option>
                  <option value="3">⭐⭐⭐</option>
                  <option value="2">⭐⭐</option>
                  <option value="1">⭐</option>
                </select>
              </div>
              <button class="btn btn-primary rounded-pill btn-sm">
                <i class="bi bi-send me-1"></i> Submit
              </button>
            </form>
          </div>
        </div>
      </div>

      <!-- Right Column -->
      <div class="col-lg-4">
        <!-- Score Trends -->
        <div class="card rounded-3 shadow-soft hover-raise mb-3">
          <div class="card-body">
            <h5 class="fw-bold mb-3"><i class="bi bi-bar-chart-line-fill text-success me-2"></i> Score Trends</h5>
            <canvas id="scoreTrendChart"></canvas>
          </div>
        </div>

        <!-- Enrollment & Progress -->
        <div class="card rounded-3 shadow-soft hover-raise mb-3">
          <div class="card-body">
            <h5 class="fw-bold mb-3"><i class="bi bi-clipboard-check-fill text-warning me-2"></i> Progress</h5>
            <p class="small text-muted mb-2">You have completed {{ course.progress.completed }} out of {{ course.progress.total }} assignments.</p>
            <div class="progress rounded-pill mb-2">
              <div class="progress-bar bg-primary" role="progressbar"
                   style="width: {{ (course.progress.completed / course.progress.total * 100)|round(0) }}">
                {{ (course.progress.completed / course.progress.total * 100)|round(0) }}%
              </div>
            </div>
            <p class="small text-muted mb-0">Enrolled students: <strong>{{ course.enrollment }}</strong></p>
          </div>
        </div>

        <!-- Tags -->
        <div class="card rounded-3 shadow-soft hover-raise">
          <div class="card-body">
            <h5 class="fw-bold mb-3"><i class="bi bi-tags-fill text-secondary me-2"></i> Tags</h5>
            {% for tag in course.tags %}
            <span class="badge bg-secondary me-1 mb-1">{{ tag }}</span>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{{ url_for('static', filename='js/course.js') }}"></script>
{% endblock %}
