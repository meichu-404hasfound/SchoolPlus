{% extends "base.html" %}

{% block title %}Home ¬∑ School Platform{% endblock %}

{% block extra_css %}{% endblock %}

{% block content %}
<!-- Hero -->
<section class="py-5">
  <div class="container">
    <div class="row align-items-center g-4">
      <div class="col-lg-7">
        <h1 class="display-5 fw-bold mb-3 gradient-text">Welcome back, {{ user.name }}!</h1>
        <p class="lead text-muted mb-4">
          Access your courses, grades, schedule, and messages in one place.
        </p>
        <div class="d-flex flex-wrap gap-2">
          <a href="{{ url_for('index.dashboard') }}" class="btn btn-primary rounded-pill px-4 py-2">
            <i class="bi bi-speedometer2 me-1"></i> Dashboard
          </a>
          <a href="{{ url_for('index.courses') }}" class="btn btn-outline-secondary rounded-pill px-4 py-2">
            <i class="bi bi-journal-text me-1"></i> Courses
          </a>
          <a href="{{ url_for('index.profile_get') }}" class="btn btn-accent rounded-pill px-4 py-2">
            <i class="bi bi-person-circle me-1"></i> Profile
          </a>
        </div>
      </div>
      <div class="col-lg-5">
        <div class="card rounded-3 shadow-soft hover-raise h-100">
          <div class="card-body">
            <!-- Section Header -->
            <h5 class="fw-bold mb-3">
              <i class="bi bi-megaphone-fill text-primary me-2"></i> Top Issue
            </h5>

            <!-- Clickable Card -->
            <a href="{{ url_for('forum.forum_home') }}" class="text-reset text-decoration-none d-block">
              <div class="p-3 rounded-3 bg-light hover-raise">
                <!-- Title + Upvotes -->
                <div class="d-flex justify-content-between align-items-start mb-2">
                  <h6 class="fw-bold mb-0 text-truncate" title="{{ issue.title }}">
                    {{ issue.title }}
                  </h6>
                  <span class="badge bg-light text-dark">{{ issue.upvote }} üëç</span>
                </div>

                <!-- Body preview -->
                <p class="text-secondary small mb-3 text-truncate" title="{{ issue.body }}">
                  {{ issue.body }}
                </p>

                <!-- Meta info -->
                <div class="d-flex justify-content-between align-items-center small">
                  <span class="text-muted">Author:
                    <span class="badge bg-light border text-dark">{{ issue.author_id }}</span>
                  </span>
                  <span class="text-muted">{{ issue.created_at }}</span>
                </div>
              </div>
            </a>
          </div>
        </div>
      </div>

    </div>
  </div>
</section>

<!-- Announcements -->
<section class="py-3">
  <div class="container">
    <h2 class="h4 fw-semibold mb-3">Latest Announcements</h2>
    <div class="vstack gap-2">
      {% for a in announcements %}
      <div class="alert alert-{{ a.type }} alert-dismissible fade show mb-0" role="alert">
        <i
          class="bi me-1 {% if a.type=='success' %}bi-check-circle{% elif a.type=='danger' %}bi-exclamation-triangle{% else %}bi-info-circle{% endif %}"></i>
        {{ a.msg }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
      {% endfor %}
    </div>
  </div>
</section>

<!-- Quick Actions -->
<section class="py-5">
  <div class="container">
    <div class="row g-4">
      <!-- Courses -->
      <div class="col-md-6 col-lg-4">
        <div class="card rounded-3 shadow-soft hover-raise h-100">
          <div class="card-body p-3">
            <div class="d-flex align-items-center mb-2">
              <i class="bi bi-journal-text fs-3 me-2"></i>
              <h5 class="mb-0">My Courses</h5>
            </div>
            <p class="text-muted small mb-3">Access enrolled courses and materials.</p>
            <a href="{{ url_for('index.courses') }}" class="btn btn-primary rounded-pill btn-sm px-3">Open</a>
          </div>
        </div>
      </div>
      <!-- Grades -->
      <div class="col-md-6 col-lg-4">
        <div class="card rounded-3 shadow-soft hover-raise h-100">
          <div class="card-body p-3">
            <div class="d-flex align-items-center mb-2">
              <i class="bi bi-bar-chart-line fs-3 me-2"></i>
              <h5 class="mb-0">Grades</h5>
            </div>
            <p class="text-muted small mb-3">Check your academic performance.</p>
            <a href="{{ url_for('index.grades') }}" class="btn btn-outline-secondary rounded-pill btn-sm px-3">View</a>
          </div>
        </div>
      </div>
      <!-- Messages -->
      <div class="col-md-6 col-lg-4">
        <div class="card rounded-3 shadow-soft hover-raise h-100">
          <div class="card-body p-3">
            <div class="d-flex align-items-center mb-2">
              <i class="bi bi-chat-dots fs-3 me-2"></i>
              <h5 class="mb-0">Messages</h5>
            </div>
            <p class="text-muted small mb-3">Communicate with peers and teachers.</p>
            <a href="{{ url_for('index.dashboard') }}" class="btn btn-accent rounded-pill btn-sm px-3">Inbox</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Classes -->
<section class="py-5">
  <div class="container">
    <div class="row g-4">
      <!-- Upcoming Classes -->
      <div class="col-lg-8">
        <div class="card rounded-3 shadow-soft hover-raise h-100">
          <div class="card-body p-3">
            <div class="d-flex align-items-center justify-content-between mb-3">
              <h5 class="mb-0">Upcoming Classes</h5>
              <a href="{{ url_for('index.courses') }}" class="btn btn-outline-secondary btn-sm rounded-pill">Full
                Schedule</a>
            </div>
            <div class="table-responsive">
              <table class="table table-striped table-hover align-middle mb-0">
                <thead>
                  <tr>
                    <th>Course</th>
                    <th>Time</th>
                    <th>Room</th>
                    <th>Status</th>
                  </tr>
                </thead>
                <tbody>
                  {% for row in upcoming %}
                  <tr>
                    <td>{{ row.course }}</td>
                    <td>{{ row.when }}</td>
                    <td>{{ row.room }}</td>
                    <td><span class="badge rounded-pill text-bg-info">{{ row.status }}</span></td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- Profile shortcut -->
      <div class="col-lg-4">
        <div class="card rounded-3 shadow-soft hover-raise h-100">
          <div class="card-body p-3 text-center">
            <h5 class="mb-3">Profile Quick Access</h5>
            <p class="text-muted small">Update your info and preferences.</p>
            <a href="{{ url_for('index.profile_get') }}" class="btn btn-primary rounded-pill">
              <i class="bi bi-person-circle me-1"></i> Go to Profile
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Floating Chatbot Button -->
<a href="{{ url_for('chatbot.chat') }}"
   class="btn btn-primary rounded-circle shadow-lg d-flex align-items-center justify-content-center"
   id="chatbotFab"
   aria-label="Open AI Chatbot">
  <i class="bi bi-robot fs-4"></i>
</a>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/index.js') }}"></script>
{% endblock %}